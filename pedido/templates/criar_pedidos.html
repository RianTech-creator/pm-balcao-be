{% extends "base.html" %}

{% block title %}
Fazer Pedido
{% endblock %}

{% block header %}
<h1>Cantina do Aluno - Fazer Pedido</h1>
{% endblock %}

{% block main %}
<section>
    <h2>Bem-vindo ao Cardápio {{  user.get_full_name|default:user.username }}</h2>
    <p>Selecione os itens que deseja pedir e clique em "Finalizar Pedido".</p>

    {% comment %}
    A view `criar_pedidos` precisa passar uma lista de produtos no contexto,
    com o nome 'cardapio'. Exemplo de um item do cardápio:
    item = {
        'id': 1, 
        'nome': 'Misto Quente', 
        'descricao': 'Pão, queijo e presunto.', 
        'preco': 5.00
    }
    {% endcomment %}

    {% if cardapio %}
        <form method="post" action="{% url 'criar_pedidos' %}">
            {% csrf_token %}
            <table style="width:100%; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f2f2f2;">
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Item</th>
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Descrição</th>
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Preço Unitário</th>
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">Quantidade</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cardapio %}
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">{{ item.nome }}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">{{ item.descricao }}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">R$ {{ item.preco|floatformat:2 }}</td>
                            <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">
                                <input type="number" name="item_{{ item.id }}" value="0" min="0" max="20" style="width: 60px;">
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <br>
            <button type="submit">Finalizar Pedido</button>
        </form>
    {% else %}
        <p>O cardápio não está disponível no momento. Tente novamente mais tarde.</p>
    {% endif %}
    <br>
    <a href="{% url 'painel_usuario' %}">
        <button type="button">Voltar ao Painel</button>
    </a>
</section>
{% endblock %}

{% block footer %}
<p>© 2025 Cantina do Aluno</p>
{% endblock %}